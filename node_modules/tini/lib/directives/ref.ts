import {Directive} from '../component/directive';
import {Registry} from './registry';

const refDirective: Directive = {
    attribute: (attr: Attr) => attr.nodeName === '#ref',
    process: ({targetNode, componentNode, attribute}) => {
        const key = attribute.nodeValue;
        if (typeof key === 'string') {
            const root: any = componentNode as any;
            root.$ = root.ref = {
                ...(root.ref || {}),
                [key]: targetNode
            };
        }
        // @ts-ignore
        componentNode.requestUpdate();
    }
}

Registry.register(refDirective);